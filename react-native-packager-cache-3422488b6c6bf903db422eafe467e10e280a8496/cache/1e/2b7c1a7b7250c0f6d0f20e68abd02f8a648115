Object.defineProperty(exports, "__esModule", {
    value: true
});
var _jsxFileName = '/home/jarek/battleCraftSound/battleCraftMobile/App/components/account/NoAuthPanel/ResetPasswordForm/ResetPasswordPopup.js';

var _react = require('react');

var _react2 = babelHelpers.interopRequireDefault(_react);

var _reactNative = require('react-native');

var _reactNativeFormGenerator = require('react-native-form-generator');

var _reactNativeModal = require('react-native-modal');

var _reactNativeModal2 = babelHelpers.interopRequireDefault(_reactNativeModal);

var _EntityPanelStyle = require('../../../../Styles/CollectionPanelStyles/EntityPanelStyle');

var _EntityPanelStyle2 = babelHelpers.interopRequireDefault(_EntityPanelStyle);

var _MainStyles = require('../../../../Styles/UniversalStyles/MainStyles');

var _MainStyles2 = babelHelpers.interopRequireDefault(_MainStyles);

var _InputStyles = require('../../../../Styles/UniversalStyles/InputStyles');

var _InputStyles2 = babelHelpers.interopRequireDefault(_InputStyles);

var _EntityPanelInputsStyles = require('../../../../Styles/CollectionPanelStyles/EntityPanelInputsStyles');

var _EntityPanelInputsStyles2 = babelHelpers.interopRequireDefault(_EntityPanelInputsStyles);

var _BaseColours = require('battleCraftMobile/App/main/consts/BaseColours');

var _BaseColours2 = babelHelpers.interopRequireDefault(_BaseColours);

var _ValidationErrorMessage = require('../../../entityPanel/outputs/ValidationErrorMessage');

var _ValidationErrorMessage2 = babelHelpers.interopRequireDefault(_ValidationErrorMessage);

var _index = require('../../../../redux/actions/index');

var _redux = require('redux');

var _reactRedux = require('react-redux');

var _serverName = require('../../../../main/consts/serverName');

var _axios = require('axios');

var _axios2 = babelHelpers.interopRequireDefault(_axios);

var ResetPasswordPopup = function (_Component) {
    babelHelpers.inherits(ResetPasswordPopup, _Component);

    function ResetPasswordPopup(props) {
        babelHelpers.classCallCheck(this, ResetPasswordPopup);

        var _this = babelHelpers.possibleConstructorReturn(this, (ResetPasswordPopup.__proto__ || Object.getPrototypeOf(ResetPasswordPopup)).call(this, props));

        _this.state = {
            email: "",
            validationError: ""
        };
        return _this;
    }

    babelHelpers.createClass(ResetPasswordPopup, [{
        key: 'resetPassword',
        value: function resetPassword() {
            var _this2 = this;

            if (this.state.validationError !== "") this.setState({ validationError: "" });

            if (!this.state.email.match(new RegExp("(^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.+[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@+(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$)"))) {
                this.setState({ validationError: "Invalid email" });
                return;
            }

            var resetPasswordOperation = function resetPasswordOperation() {
                _this2.props.startLoading("Reseting password...");
                _axios2.default.post(_serverName.serverName + "auth/reset/password", { email: _this2.state.email }).then(function (res) {
                    _this2.props.stopLoading();
                    _this2.props.showSuccessMessage("Username and new password were sent to you e-mail address");
                    _this2.props.disable();
                }).catch(function (error) {
                    _this2.props.stopLoading();
                    _this2.props.showNetworkErrorMessage(error, resetPasswordOperation);
                });
            };

            resetPasswordOperation();
        }
    }, {
        key: 'calculatePanelHeight',
        value: function calculatePanelHeight() {
            return this.props.dimension.orientation === 'portrait' ? this.props.dimension.height * 0.5 : this.props.dimension.height * 0.77;
        }
    }, {
        key: 'calculateInnerHeight',
        value: function calculateInnerHeight() {
            return this.props.orientation === 'portrait' ? this.props.dimension.height * 0.5 - 200 : this.props.dimension.height * 0.77 - 180;
        }
    }, {
        key: 'render',
        value: function render() {
            var _this3 = this;

            return _react2.default.createElement(
                _reactNativeModal2.default,
                { isVisible: !this.props.hidden, backdropOpacity: 0.3, __source: {
                        fileName: _jsxFileName,
                        lineNumber: 78
                    }
                },
                _react2.default.createElement(
                    _reactNative.View,
                    { style: [_EntityPanelStyle2.default.modal, {
                            width: this.props.dimension.width * 0.9,
                            height: this.calculatePanelHeight()
                        }], __source: {
                            fileName: _jsxFileName,
                            lineNumber: 79
                        }
                    },
                    _react2.default.createElement(
                        _reactNative.View,
                        { style: [_EntityPanelStyle2.default.title, { alignItems: 'center' }], __source: {
                                fileName: _jsxFileName,
                                lineNumber: 83
                            }
                        },
                        _react2.default.createElement(
                            _reactNative.Text,
                            { style: [_MainStyles2.default.textStyle, { fontSize: 22 }], __source: {
                                    fileName: _jsxFileName,
                                    lineNumber: 84
                                }
                            },
                            'Reset password'
                        )
                    ),
                    _react2.default.createElement(
                        _reactNative.View,
                        { style: [_EntityPanelStyle2.default.formWindow], __source: {
                                fileName: _jsxFileName,
                                lineNumber: 86
                            }
                        },
                        _react2.default.createElement(
                            _reactNative.ScrollView,
                            {
                                contentContainerStyle: _EntityPanelStyle2.default.scrollView, __source: {
                                    fileName: _jsxFileName,
                                    lineNumber: 87
                                }
                            },
                            _react2.default.createElement(
                                _reactNative.View,
                                { style: _InputStyles2.default.inputCard, __source: {
                                        fileName: _jsxFileName,
                                        lineNumber: 89
                                    }
                                },
                                _react2.default.createElement(
                                    _reactNative.View,
                                    { style: _InputStyles2.default.inputText, __source: {
                                            fileName: _jsxFileName,
                                            lineNumber: 90
                                        }
                                    },
                                    _react2.default.createElement(
                                        _reactNative.Text,
                                        { style: [_MainStyles2.default.smallWhiteStyle, { fontWeight: 'bold' }], __source: {
                                                fileName: _jsxFileName,
                                                lineNumber: 90
                                            }
                                        },
                                        'E-mail:'
                                    )
                                ),
                                _react2.default.createElement(
                                    _reactNative.View,
                                    { style: _EntityPanelInputsStyles2.default.inputStyle, __source: {
                                            fileName: _jsxFileName,
                                            lineNumber: 91
                                        }
                                    },
                                    _react2.default.createElement(
                                        _reactNative.Text,
                                        {
                                            __source: {
                                                fileName: _jsxFileName,
                                                lineNumber: 92
                                            }
                                        },
                                        'E-mail:'
                                    ),
                                    _react2.default.createElement(_reactNativeFormGenerator.InputField, {
                                        onValueChange: function onValueChange(value) {
                                            _this3.setState({ email: value });
                                        },
                                        value: this.state.email,
                                        placeholder: 'jarek123@gmail.com',
                                        __source: {
                                            fileName: _jsxFileName,
                                            lineNumber: 93
                                        }
                                    })
                                ),
                                _react2.default.createElement(_ValidationErrorMessage2.default, {
                                    validationErrorMessage: this.state.validationError, __source: {
                                        fileName: _jsxFileName,
                                        lineNumber: 99
                                    }
                                })
                            )
                        )
                    ),
                    _react2.default.createElement(
                        _reactNative.View,
                        { style: _EntityPanelStyle2.default.buttonRow, __source: {
                                fileName: _jsxFileName,
                                lineNumber: 104
                            }
                        },
                        _react2.default.createElement(
                            _reactNative.TouchableHighlight,
                            { key: 'save', style: [_EntityPanelStyle2.default.button, { backgroundColor: _BaseColours2.default.misc.deepRed }], onPress: function onPress() {
                                    _this3.resetPassword();
                                }, __source: {
                                    fileName: _jsxFileName,
                                    lineNumber: 105
                                }
                            },
                            _react2.default.createElement(
                                _reactNative.Text,
                                { style: _MainStyles2.default.bigWhiteStyle, __source: {
                                        fileName: _jsxFileName,
                                        lineNumber: 106
                                    }
                                },
                                'Save'
                            )
                        ),
                        _react2.default.createElement(
                            _reactNative.TouchableHighlight,
                            { key: 'close', style: [_EntityPanelStyle2.default.button, { backgroundColor: _BaseColours2.default.misc.deepRed }], onPress: function onPress() {
                                    _this3.props.disable();
                                }, __source: {
                                    fileName: _jsxFileName,
                                    lineNumber: 108
                                }
                            },
                            _react2.default.createElement(
                                _reactNative.Text,
                                { style: _MainStyles2.default.bigWhiteStyle, __source: {
                                        fileName: _jsxFileName,
                                        lineNumber: 109
                                    }
                                },
                                'Close'
                            )
                        )
                    )
                )
            );
        }
    }]);
    return ResetPasswordPopup;
}(_react.Component);

function mapDispatchToProps(dispatch) {
    return (0, _redux.bindActionCreators)(_index.ActionCreators, dispatch);
}

function mapStateToProps(state) {
    return {
        dimension: state.dimension
    };
}

exports.default = (0, _reactRedux.connect)(mapStateToProps, mapDispatchToProps)(ResetPasswordPopup);